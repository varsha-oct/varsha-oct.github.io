<html>


	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<style>
		.goclick{
		position: relative;
		z-index: 9;
		}
		</style>
	</head>
	<script>
		function logout(){
			SN_CSM_EC.onLogout();
		}

		function tokenUpdated(){
			window.dispatchEvent(new CustomEvent('tokenUpdated', { detail: "test" }));
		}		    
	</script> 	
	<body>
		<h1>Welcome to TPP (Token based)</h1>
		 <a id="login" href="https://dev-4237775.okta.com/oauth2/v1/authorize?client_id=0oa1cz1hkKQv0CK845d6&redirect_uri=https://varsha-oct.github.io&state=1&scope=openid offline_access email&response_type=code id_token&response_mode=fragment&nonce=3ud9rzze0gf"class="goclick">Login with Okta_OIDC</a> 
		
		
		
		
		<a id="logout" href="" onclick="logout()">Logout</a>
		<div id="guest">
			Hi Guest.</div>
		<div id="user">
			Hi Nilesh.</div>		
		
		<p> This is 3rd party appliation and embeddable is added here by adding sp_main_widget script<b>(localhost here)</b></p>
		<p>Highlights below: </p>
		<p>1. Embeddable will appear when DOM and it's own content is loaded</p>
		<p>2. External portal need to put just one script in their html <code>sp_main_widget.js</code></p>
		<p>3. Exposed <code>snEmbedWidget</code> object to window which have api to control embeddable</p>
		<p>4. Ability to pass information into the embeddable via <code>snEmbedWidget.setConfig</code> method</p>
		<p>5. Dynamic placing of launcher icon</p>
		<p>6. Dynamic height of embeddable</p>
		<p>7. Test OIDC</p>
	
		<p>P.S. To Start the server run <code>npm install</code> and then <code>npm run start</code> from project folder in terminal. Thnaks!!!</p>
	
		<script>
		
		var params = window.location.hash.substring(1).split("&");
		console.log(params);
		if(params[0].indexOf('id_token') != "-1"){
			var x = document.getElementById("login");
			x.style.display = "none";
			var y = document.getElementById("logout");
			y.style.display = "block";	
			var gst = document.getElementById("guest");
			gst.style.display = "none";	
			var usr = document.getElementById("user");
			usr.style.display = "block";			
		}
		else {
			var x = document.getElementById("login");
			x.style.display = "block";
			var y = document.getElementById("logout");
			y.style.display = "none";			
			var gst = document.getElementById("guest");
			gst.style.display = "block";	
			var usr = document.getElementById("user");
			usr.style.display = "none";					
		}
		</script>
		<script src="https://k8s0123522-node1.sdthunder.lab3.service-now.com/scripts/sn_csm_ec.js"></script>
<script>
SN_CSM_EC.init({
	moduleID: "https://k8s0123522-node1.sdthunder.lab3.service-now.com/#4dbcd084fc302010f877862226fa8b1b",
	tokenCallBack: getTokenCallBack 
});
function getTokenCallBack(){
			let idToken; let params = window.location.hash.substring(1).split("&"); idToken = params[0].split("=")[1];
			return Promise.resolve(idToken);
}

/* Call SN_CSM_EC.onLogin() function to start the user session in the Engagement Center automatically when the user logs in to the main portal */
/* Call SN_CSM_EC.onLogout() function to terminate the user session in the Engagement Center automatically when the user logs out from the main portal */
</script>
		<script>
		var params = window.location.hash.substring(1).split("&");
		var idToken = "";
		var userID;
		if(params[0].indexOf('id_token') != "-1"){
		SN_CSM_EC.onLogin();
		}
		</script> 
	</body>	
</html>
